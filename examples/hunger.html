<head>
  <base href=".." />
</head>
<body>
<script src="source/Data.js"></script>
<script src="source/Map.js"></script>
<script src="source/Object.js"></script>
<script src="source/Time.js"></script>
<script src="data/Properties.js"></script>
<script src="data/Quests.js"></script>
<script src="data/Resources.js"></script>
<script src="data/Actions.js"></script>
<script src="data/Creatures.js"></script>
<script src="data/Items.js"></script>
<script src="lib/Seed.js"></script>
<script>

  var seed = parseFloat(location.search.split('seed=')[1]) || Math.random();
  Math.seedrandom(seed)
  document.write('seed: <b>' + seed + '</b><br>')
</script>
<script>

  var canvas = document.createElement('canvas');
  var ctx = canvas.getContext('2d');
  canvas.width = 81// * 4
  canvas.height =81// * 4
  canvas.imageSmoothingEnabled = false
  canvas.mozImageSmoothingEnabled = false
  canvas.webkitImageSmoothingEnabled = false
  var map = new Map(4);
  map.scale = 8
  map.zone = 1111
  map.z = 4;

  map.canvas = canvas;



 //var rabbit2 = Game('creatures.animals.vermin.rabbit');
 //map(11113172, rabbit2)
 //var rabbit3 = Game('creatures.animals.vermin.rabbit');
 //map(11113173, rabbit3)
 //var rabbit4 = Game('creatures.animals.vermin.rabbit');
 //map(11113174, rabbit4)
 //var rabbit5 = Game('creatures.animals.vermin.rabbit');
 //map(11113175, rabbit5)
 //var rabbit6 = Game('creatures.animals.vermin.rabbit');
 //map(11113176, rabbit6)

  var prefix = 1111;
  var random = function(max) {
    var number = prefix
    for (var i = 0; i < max; i++)
      number = number * 10 + Math.floor(Math.random() * 9) + 1
    console.error(number)
    return number
  }
  var bushes = parseInt(location.search.split('bushes=')[1]) || 2;

  for (var i = 0; i < bushes; i++) {
    map(random(4), Game('creatures.plants.bushes.strawberry',
        Game.valueOf('resources.food.plants.fruit', 10)
    ))
  }

  var rabbits = parseInt(location.search.split('rabbits=')[1]) || 2;

  for (var i = 0; i < rabbits; i++) {
    var rabbit = Game('creatures.animals.vermin.rabbit');
    map(random(4), rabbit)
  }
  var time = 0;
  console.profile(3)
  var interval = parseInt(location.search.split('interval=')[1]);
  var max = parseInt(location.search.split('max=')[1]);
  var tick = function() {
    window.$time = time = Time(time, map)
    map.draw(rabbit);    
    if (!map.canvas.parentNode)
    document.body.appendChild(map.canvas);
  }
  if (interval)
      var intervalium = setInterval(function() {
        if (time > max)
          clearInterval(intervalium)
        else
          tick()
      }, interval)
  else {
    console.profileEnd(3)
    //time = Time(time, map)
    time = Time(time, map)
    map.draw(rabbit);
    document.body.appendChild(map.canvas);
  }
  //window.$tick = 3;
  //console.error('tick 3')
</script>

</body>